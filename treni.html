<!doctype html>
<html lang="it">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Orario dei treni</title>
  </head>
  <body>

    <div class="container">
      <button>Clicca qui!</button>
    </div>

    <div id="pippe"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


<!--script>
    $(document).ready(function(){
      $("button").click(function(){
function createCORSRequest(method, url) {
  var xhr = new XMLHttpRequest();

  if ("withCredentials" in xhr) {
    // Check if the XMLHttpRequest object has a "withCredentials" property.
    // "withCredentials" only exists on XMLHTTPRequest2 objects.
    xhr.open(method, url, true);
    
  } else if (typeof XDomainRequest != "undefined") {

    // Otherwise, check if XDomainRequest.
    // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
    xhr = new XDomainRequest();
    xhr.open(method, url);

  } else {

    // Otherwise, CORS is not supported by the browser.
    xhr = null;

  }
  return xhr;
}
var url= 'https://www.lefrecce.it/msite/api/solutions?origin=VERNAZZA&destination=RIOMAGGIORE&arflag=A&adate=28/12/2019&atime=13&adultno=1&childno=0&direction=A&frecce=false&onlyRegional=false';
var xhr = createCORSRequest('GET', url);
if (!xhr) {
  throw new Error('CORS not supported');
}

// Response handlers.
  xhr.onload = function() {
    var text = xhr.responseText;
    var title = getTitle(text);
    alert('Response from CORS request to ' + url + ': ' + title);
  };

  xhr.onerror = function() {
    alert('Woops, there was an error making the request.');
  };

  xhr.send();
  

      })
        })
</script-->


<script>
    $(document).ready(function(){
      $("button").click(function(){

//var myUrl = 'http://www.geoplugin.net/json.gp?ip=216.58.209.68';
var myUrl = 'https://www.lefrecce.it/msite/api/solutions?origin=VERNAZZA&destination=RIOMAGGIORE&arflag=A&adate=28/12/2019&atime=13&adultno=1&childno=0&direction=A&frecce=false&onlyRegional=false';
//  But if you make it from a browser, then it will work without problem ...

// However to make it work, we are going to use the cors-anywhere free service to bypass this
var proxy = 'https://cors-anywhere.herokuapp.com/';

$.ajax({
    // The proxy url expects as first URL parameter the URL to be bypassed
    // https://cors-anywhere.herokuapp.com/{my-url-to-bypass}
    url: proxy + myUrl,
    complete:function(data){
//        console.log(data);
        viewJSON(data);
    }
});


/** funzione di lettura del file JSON ottenuto */
function viewJSON (jsonObj) {

  var json = jsonObj.responseJSON;
//    document.getElementById("pippe").innerHTML += JSON.stringify(json);

    document.getElementById("pippe").innerHTML += "Partenza: "+json[0].origin;
    document.getElementById("pippe").innerHTML += "<BR>Arrivo: "+json[0].destination;
    document.getElementById("pippe").innerHTML += "<BR>Data: "+dateConverter(json[0].departuretime);

    for (var i in json){
      timeP = new Date(json[i].departuretime); 
      timeA = new Date(json[i].arrivaltime); 
      formattedTimeP = timeConverter(timeP);
      formattedTimeA = timeConverter(timeA);

      document.getElementById("pippe").innerHTML += "<br>Orario Partenza: "+formattedTimeP;
      document.getElementById("pippe").innerHTML += " | Orario Arrivo: "+formattedTimeA;
//      console.log("Orario Partenza: "+formattedTimeP);
//      console.log("Orario Arrivo: "+formattedTimeA);
    }

}

/* formattazione della data unixtimestamp in formato italiano hh:mm:ss */
function timeConverter(UNIX_timestamp){
  orario = new Date(UNIX_timestamp).toLocaleTimeString("it-IT")  

  return orario;
}

/* formattazione della data unixtimestamp in formato italiano gg/mm/aaaa */
function dateConverter(UNIX_timestamp){
  data = new Date(UNIX_timestamp).toLocaleDateString("it-IT");

  return data;
}


      })
        })
</script>



  </body>
</html>
