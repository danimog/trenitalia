<!doctype html>
<html lang="it">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Orario dei treni</title>
  </head>
  <body>

    <div class="container">
      <div class="row">
        <div class="col-sm-6">
          STAZIONE PARTENZA
          <div class="form-check-P">
            <input class="form-check-input" type="radio" name="partenza" id="stazionePartenza" value="monterosso" checked>
            <label class="form-check-label" for="stazione1">Monterosso</label>
          </div>

          <div class="form-check-P">
            <input class="form-check-input" type="radio" name="partenza" id="stazionePartenza" value="vernazza" >
            <label class="form-check-label" for="stazione1">Vernazza</label>
          </div>

          <div class="form-check-P">
            <input class="form-check-input" type="radio" name="partenza" id="stazionePartenza" value="corniglia" >
            <label class="form-check-label" for="stazione1">Corniglia</label>
          </div>

          <div class="form-check-P">
            <input class="form-check-input" type="radio" name="partenza" id="stazionePartenza" value="manarola" >
            <label class="form-check-label" for="stazione1">Manarola</label>
          </div>

          <div class="form-check-P">
            <input class="form-check-input" type="radio" name="partenza" id="stazionePartenza" value="riomaggiore" >
            <label class="form-check-label" for="stazione1">Riomaggiore</label>
          </div>
        </div>
      <div class="col-sm-6">
          STAZIONE ARRIVO
          <div class="form-check-A">
            <input class="form-check-input" type="radio" name="arrivo" id="stazioneArrivo" value="monterosso" >
            <label class="form-check-label" for="stazione1">Monterosso</label>
          </div>

          <div class="form-check-A">
            <input class="form-check-input" type="radio" name="arrivo" id="stazioneArrivo" value="vernazza" >
            <label class="form-check-label" for="stazione1">Vernazza</label>
          </div>

          <div class="form-check-A">
            <input class="form-check-input" type="radio" name="arrivo" id="stazioneArrivo" value="corniglia" >
            <label class="form-check-label" for="stazione1">Corniglia</label>
          </div>

          <div class="form-check-A">
            <input class="form-check-input" type="radio" name="arrivo" id="stazioneArrivo" value="manarola" >
            <label class="form-check-label" for="stazione1">Manarola</label>
          </div>

          <div class="form-check-A">
            <input class="form-check-input" type="radio" name="arrivo" id="stazioneArrivo" value="riomaggiore" checked>
            <label class="form-check-label" for="stazione1">Riomaggiore</label>
          </div>
        </div>
  
    </div>


      <button type="button" class="btn btn-primary">Clicca qui!</button>
      <div id="pippe"></div>
    
    </div>


    <!-- SCRIPT CARICAMENTO JQUERY e BOOTSTRAP -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(document).ready(function(){
      $("button").click(function(){

        console.log(document.getElementByClassName("form-check-A").value);

var myUrl = 'https://www.lefrecce.it/msite/api/solutions?origin=VERNAZZA&destination=RIOMAGGIORE&arflag=A&adate=28/12/2019&atime=13&adultno=1&childno=0&direction=A&frecce=false&onlyRegional=false';
//  But if you make it from a browser, then it will work without problem ...

// However to make it work, we are going to use the cors-anywhere free service to bypass this
var proxy = 'https://cors-anywhere.herokuapp.com/';

$.ajax({
    // The proxy url expects as first URL parameter the URL to be bypassed
    // https://cors-anywhere.herokuapp.com/{my-url-to-bypass}
    url: proxy + myUrl,
    complete:function(data){
//        console.log(data);
        viewJSON(data);
    }
});


/** funzione di lettura del file JSON ottenuto */
function viewJSON (jsonObj) {

  var json = jsonObj.responseJSON;
//    document.getElementById("pippe").innerHTML += JSON.stringify(json);

    document.getElementById("pippe").innerHTML += "Partenza: "+json[0].origin;
    document.getElementById("pippe").innerHTML += "<BR>Arrivo: "+json[0].destination;
    document.getElementById("pippe").innerHTML += "<BR>Data: "+dateConverter(json[0].departuretime);

    for (var i in json){
      timeP = new Date(json[i].departuretime); 
      timeA = new Date(json[i].arrivaltime); 
      formattedTimeP = timeConverter(timeP);
      formattedTimeA = timeConverter(timeA);

      document.getElementById("pippe").innerHTML += "<br>Orario Partenza: "+formattedTimeP;
      document.getElementById("pippe").innerHTML += " | Orario Arrivo: "+formattedTimeA;
//      console.log("Orario Partenza: "+formattedTimeP);
//      console.log("Orario Arrivo: "+formattedTimeA);
    }

}

/* formattazione della data unixtimestamp in formato italiano hh:mm:ss */
function timeConverter(UNIX_timestamp){
  orario = new Date(UNIX_timestamp).toLocaleTimeString("it-IT")  

  return orario;
}

/* formattazione della data unixtimestamp in formato italiano gg/mm/aaaa */
function dateConverter(UNIX_timestamp){
  data = new Date(UNIX_timestamp).toLocaleDateString("it-IT");

  return data;
}


      })
        })
</script>



  </body>
</html>
